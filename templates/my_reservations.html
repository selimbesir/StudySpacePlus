{% extends "base.html" %}

{% block content %}
<h2>My Reservations</h2>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="flash-message {{ category }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<div class="card" style="padding: 20px; margin-bottom: 40px;">
    <h3 style="color: #2c3e50; margin-top: 0;">Upcoming & Active</h3>
    
    {% if active_reservations|length == 0 %}
        <p style="color: #777;">No upcoming reservations.</p>
    {% else %}
    <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
        <thead>
            <tr style="background: #e8f6f3; text-align: left; border-bottom: 2px solid #27ae60;">
                <th style="padding: 12px;">Date</th>
                <th style="padding: 12px;">Time</th>
                <th style="padding: 12px;">Location</th>
                <th style="padding: 12px;">Size</th>
                <th style="padding: 12px;">Status</th>
                <th style="padding: 12px;">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for res in active_reservations %}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 12px;">{{ res.date }}</td>
                <td style="padding: 12px;">{{ res.time_slot }}</td>
                <td style="padding: 12px;">{{ res.space_name }} (Block {{ res.block_name }})</td>
                <td style="padding: 12px; font-weight: bold; text-align: center;">{{ res.group_size }}</td>
                
                <td style="padding: 12px;">
                    {% if res.status == 'Checked In' %}
                        <span style="color: #27ae60; font-weight: bold;">✔ Checked In</span>
                    {% else %}
                        {% endif %}
                </td>

                <td style="padding: 12px; display: flex; gap: 10px;">
                    {% if res.status == 'Confirmed' %}
                        <form action="{{ url_for('check_in', res_id=res.id) }}" method="POST">
                            <button type="submit" class="btn-checkin">Check In</button>
                        </form>
                    {% endif %}
                    <form action="{{ url_for('cancel_reservation', res_id=res.id) }}" method="POST">
                        <button type="submit" class="btn-cancel">Cancel</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
</div>

<div class="card" style="padding: 20px; background-color: #f9f9f9;">
    <h3 style="color: #7f8c8d; margin-top: 0;">History</h3>
    
    {% if past_reservations|length == 0 %}
        <p style="color: #aaa;">No history available.</p>
    {% else %}
    <table style="width: 100%; border-collapse: collapse; margin-top: 15px; color: #7f8c8d;">
        <thead>
            <tr style="background: #eee; text-align: left; border-bottom: 2px solid #ccc;">
                <th style="padding: 12px;">Date</th>
                <th style="padding: 12px;">Time</th>
                <th style="padding: 12px;">Location</th>
                <th style="padding: 12px;">Status</th>
            </tr>
        </thead>
        <tbody>
            {% for res in past_reservations %}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 12px;">{{ res.date }}</td>
                <td style="padding: 12px;">{{ res.time_slot }}</td>
                <td style="padding: 12px;">{{ res.space_name }}</td>
                
                <td style="padding: 12px;">
                    {% if res.status == 'Completed' %}
                        <span style="color: #27ae60;">✔ Completed</span>
                    {% elif res.status == 'Forfeited (No Show)' %}
                        <span style="color: #c0392b; font-weight: bold;">❌ No Show</span>
                    {% elif res.status == 'Cancelled' %}
                        <span style="color: #c0392b;">✖ Cancelled</span>
                    {% else %}
                        {{ res.status }}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
</div>
{% endblock %}